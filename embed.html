<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Embed Builder – Test Access Map</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body { background:#f8fafb; }
    .pill { border-radius:999px; }
    .card { border-radius:16px; }
    pre, code, textarea.form-control{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .preview-wrap{
      background:#fff;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(15,23,42,.12);
      box-shadow:0 10px 30px rgba(0,0,0,.06);
    }
    .preview-title{
      font-size:.9rem;
      color:#64748b;
    }
    iframe{ display:block; width:100%; border:0; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="https://testaccess.xyz.am/">Test Access</a>
    <span class="navbar-text text-white-50">Embed Builder</span>
  </div>
</nav>

<main class="container py-4">

  <div class="row g-4">
    <!-- Options -->
    <div class="col-lg-5">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Embed options</div>
        <div class="card-body">

          <div class="mb-3">
            <label class="form-label fw-semibold">Base URL</label>
            <input id="baseUrl" class="form-control" value="https://testaccess.xyz.am/" />
            <div class="form-text">Point this to your own host if you self-host.</div>
          </div>

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label fw-semibold">Theme</label>
              <select id="theme" class="form-select">
                <option value="auto" selected>Auto (match device)</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </div>

            <div class="col-12 col-md-6">
              <label class="form-label fw-semibold">Map style</label>
              <select id="tiles" class="form-select">
                <option value="osm" selected>OpenStreetMap (default)</option>
                <option value="carto_light">Carto – Positron (light)</option>
                <option value="carto_dark">Carto – Dark Matter (dark)</option>
              </select>
              <div class="form-text">Your map page must support these tile IDs.</div>
            </div>

            <div class="col-12">
              <label class="form-label fw-semibold">Accent color</label>
              <div class="d-flex gap-2 align-items-center">
                <input id="accent" type="color" class="form-control form-control-color" value="#00b46f" />
                <input id="accentHex" class="form-control" value="00b46f" />
              </div>
              <div class="form-text">Used for buttons/badges (if supported).</div>
            </div>
          </div>

          <hr class="my-4" />

          <div class="row g-3">
            <div class="col-6">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="mapOnly" checked>
                <label class="form-check-label" for="mapOnly">Map-only (hide panels)</label>
              </div>
            </div>
            <div class="col-6">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="controls" checked>
                <label class="form-check-label" for="controls">Show controls</label>
              </div>
            </div>
            <div class="col-6">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="results" checked>
                <label class="form-check-label" for="results">Show results list</label>
              </div>
            </div>
            <div class="col-6">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="searchUi" checked>
                <label class="form-check-label" for="searchUi">Show search UI</label>
              </div>
            </div>
          </div>

          <hr class="my-4" />

          <div class="row g-3">
            <div class="col-6">
              <label class="form-label fw-semibold">Height (px)</label>
              <input id="height" type="number" class="form-control" value="650" min="200" max="2000" step="10" />
            </div>
            <div class="col-6">
              <label class="form-label fw-semibold">Border radius (px)</label>
              <input id="radius" type="number" class="form-control" value="12" min="0" max="40" step="1" />
            </div>
            <div class="col-12">
              <label class="form-label fw-semibold">Start view (optional)</label>
              <input id="hash" class="form-control" placeholder="#43.6532,-79.3832,11" />
              <div class="form-text">Format: <code>#latitude,longitude,zoom</code></div>
            </div>
          </div>

          <div class="mt-4 d-flex gap-2 flex-wrap">
            <button id="copyLink" class="btn btn-dark pill btn-sm">Copy embed URL</button>
            <button id="copyCode" class="btn btn-success pill btn-sm">Copy iframe code</button>
            <span id="status" class="small text-muted align-self-center"></span>
          </div>

        </div>
      </div>
    </div>

    <!-- Preview + Output -->
    <div class="col-lg-7">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="preview-title">Preview</div>
        <div class="small text-muted">This preview uses your generated URL.</div>
      </div>

      <div class="preview-wrap mb-3">
        <iframe id="preview" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>

      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Generated code</div>
        <div class="card-body">
          <label class="form-label">Embed URL</label>
          <input id="outUrl" class="form-control mb-3" readonly />

          <label class="form-label">Iframe code</label>
          <textarea id="outCode" class="form-control" rows="7" readonly></textarea>
          <div class="form-text mt-2">
            Tip: If your site is strict about iframes, you may need CSP updates.
          </div>
        </div>
      </div>
    </div>
  </div>

</main>

<script>
  const el = (id) => document.getElementById(id);

  function setStatus(msg, isError=false){
    const s = el("status");
    s.textContent = msg;
    s.className = "small " + (isError ? "text-danger" : "text-muted");
    if (msg) setTimeout(() => { if (s.textContent === msg) s.textContent = ""; }, 2500);
  }

  function sanitizeHex(hex){
    return (hex || "").toLowerCase().replace(/[^0-9a-f]/g,"").slice(0,6);
  }

  function buildUrl(){
    const base = (el("baseUrl").value || "https://testaccess.xyz.am/").trim().replace(/\/+$/,"") + "/";
    const u = new URL(base);

    // Map page
    // You already support ?embed=1; we’ll extend with more params.
    u.searchParams.set("embed", "1");

    const theme = el("theme").value;
    if (theme && theme !== "auto") u.searchParams.set("theme", theme);
    else u.searchParams.delete("theme");

    const tiles = el("tiles").value;
    if (tiles && tiles !== "osm") u.searchParams.set("tiles", tiles);
    else u.searchParams.delete("tiles");

    const accent = sanitizeHex(el("accentHex").value);
    if (accent && accent !== "00b46f") u.searchParams.set("accent", accent);
    else u.searchParams.delete("accent");

    // UI toggles
    // mapOnly implies hiding non-map UI inside the map page.
    u.searchParams.set("mapOnly", el("mapOnly").checked ? "1" : "0");
    u.searchParams.set("controls", el("controls").checked ? "1" : "0");
    u.searchParams.set("results", el("results").checked ? "1" : "0");
    u.searchParams.set("search", el("searchUi").checked ? "1" : "0");

    const hash = (el("hash").value || "").trim();
    if (hash && hash.startsWith("#")) u.hash = hash.substring(1);
    else u.hash = "";

    return u.toString();
  }

  function buildIframe(url){
    const h = parseInt(el("height").value || "650", 10);
    const r = parseInt(el("radius").value || "12", 10);
    return `<iframe
  src="${url}"
  width="100%"
  height="${isNaN(h) ? 650 : h}"
  style="border:0;border-radius:${isNaN(r) ? 12 : r}px;overflow:hidden"
  loading="lazy"
  referrerpolicy="no-referrer-when-downgrade">
</iframe>`;
  }

  function refresh(){
    // Sync accent text+picker
    const hex = sanitizeHex(el("accentHex").value);
    if (hex.length === 6) el("accent").value = "#" + hex;

    const url = buildUrl();
    el("outUrl").value = url;
    el("outCode").value = buildIframe(url);

    // Preview uses same URL
    el("preview").src = url;
  }

  // Events
  ["baseUrl","theme","tiles","accentHex","mapOnly","controls","results","searchUi","height","radius","hash"]
    .forEach(id => el(id).addEventListener("input", refresh));

  el("accent").addEventListener("input", () => {
    el("accentHex").value = el("accent").value.replace("#","");
    refresh();
  });

  el("copyLink").addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText(el("outUrl").value);
      setStatus("Embed URL copied.");
    }catch{
      setStatus("Couldn’t copy URL.", true);
    }
  });

  el("copyCode").addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText(el("outCode").value);
      setStatus("Iframe code copied.");
    }catch{
      setStatus("Couldn’t copy code.", true);
    }
  });

  // Init
  refresh();
</script>
</body>
</html>
